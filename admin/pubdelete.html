<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PublicitÃ©s</title>
    <link rel="stylesheet" href="pubdelete.css" />
    <link href="../img/logo_of_wallet.jpg" rel="icon" />
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.2/dist/sweetalert2.all.min.js"></script>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ“¢ PublicitÃ©s</h1>
      <div id="pubList" class="pub-list"></div>
    </div>

    <script>
      // Configuration Firebase (Remplace avec tes propres paramÃ¨tres)
      const firebaseConfig = {
        apiKey: "AIzaSyDbQjciXp0J_UGQBBcqmjlCAemYK-tsR6c",
        authDomain: "am-wallet.firebaseapp.com",
        databaseURL: "https://am-wallet-default-rtdb.firebaseio.com",
        projectId: "am-wallet",
        storageBucket: "am-wallet.appspot.com",
        messagingSenderId: "877693231070",
        appId: "1:877693231070:web:47c59ac6220ed09af9c74f",
      };

      // Initialiser Firebase
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();

      // Fonction pour rÃ©cupÃ©rer et afficher les pubs
      function publish() {
        const pubList = document.getElementById("pubList");
        pubList.innerHTML = ""; // Nettoyer avant d'afficher

        database
          .ref("/lespubs/")
          .once("value")
          .then((snapshot) => {
            snapshot.forEach((productSnapshot) => {
              const productData = productSnapshot.val();
              const pubId = productSnapshot.key; // ID unique dans Firebase

              // CrÃ©ation de la carte pub
              const pubCard = document.createElement("div");
              pubCard.classList.add("pub-card");
              pubCard.innerHTML = `
                <img src="data:image/png;base64,${productData.IMAGEPUB}" alt="PublicitÃ©">
                <a href="${productData.URLPUB}" target="_blank">ğŸ”— Voir l'offre</a>
                <button class="delete-btn" onclick="deletePub('${pubId}')">ğŸ—‘ Supprimer</button>
            `;
              pubList.appendChild(pubCard);
            });
          })
          .catch((error) => {
            Swal.fire(
              "Erreur",
              "Impossible de charger les publicitÃ©s",
              "error"
            );
          });
      }

      // Fonction pour supprimer une publicitÃ©
      function deletePub(pubId) {
        Swal.fire({
          title: "ÃŠtes-vous sÃ»r ?",
          text: "Cette action est irrÃ©versible !",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#d33",
          cancelButtonColor: "#3085d6",
          confirmButtonText: "Oui, supprimer !",
        }).then((result) => {
          if (result.isConfirmed) {
            database
              .ref(`/lespubs/${pubId}`)
              .remove()
              .then(() => {
                Swal.fire(
                  "SupprimÃ© !",
                  "La publicitÃ© a Ã©tÃ© supprimÃ©e.",
                  "success"
                );
                publish(); // Recharger la liste
              })
              .catch((error) => {
                Swal.fire("Erreur", "Ã‰chec de la suppression", "error");
              });
          }
        });
      }

      // Charger les publicitÃ©s au dÃ©marrage
      publish();
    </script>
  </body>
</html>
